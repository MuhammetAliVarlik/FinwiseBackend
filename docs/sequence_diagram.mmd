sequenceDiagram
    autonumber
    actor User
    participant FE as Frontend (React)
    participant API as API Gateway
    participant Redis as Redis Queue
    participant Worker as Celery Worker
    participant DB as Database

    User->>FE: Click "Analyze AAPL"
    FE->>API: POST /ai/forecast/AAPL
    
    Note right of API: Fire & Forget
    API->>Redis: Enqueue Task (shadow_mode)
    API-->>FE: HTTP 202 Accepted (task_id)
    
    par Background Processing
        Redis->>Worker: Dispatch Task
        Worker->>Worker: Run Inference (30s)
        Worker->>DB: Save Forecast Result
        Worker->>Redis: Mark Task as SUCCESS
    and Frontend Polling
        loop Every 2 Seconds
            FE->>API: GET /tasks/{task_id}
            API->>Redis: Check Status
            Redis-->>API: Status: PENDING
            API-->>FE: { status: "pending" }
        end
        
        %% Final Success
        FE->>API: GET /tasks/{task_id}
        API->>Redis: Check Status
        Redis-->>API: Status: SUCCESS
        API->>DB: Fetch Result
        DB-->>API: { prediction: "P_SURGE" }
        API-->>FE: { status: "completed", result: ... }
    end

    FE->>User: Display Chart & Analysis